name: Validate Branch Name

on:
  pull_request:
    branches:
      - main

jobs:
  validate_branch_name:
    runs-on: 'ubuntu-latest'
    steps:
      - name: Validate branch name and PR creator from VN
        run: |
          BRANCH_NAME="${GITHUB_REF##*/}"
          PR_CREATOR="${GITHUB_ACTOR}"
          
          IS_VN_DEV=$([[ "$PR_CREATOR" =~ -zigexn$ ]] && echo true || echo false)
          IS_VALID_FORMAT=$([[ "$BRANCH_NAME" =~ "^(feature|bug|hotfix|revert|business-rollback)/RSP-LSDIVISON-[0-9]+$" ]] && echo true || echo false)
          IS_VN_CONTRIBUTE=$([[ "$BRANCH_NAME" =~ "^vn_contribution" ]] && echo true || echo false)

          if [[ "$IS_VN_DEV" == "true" ]] && ([[ "$IS_VALID_FORMAT" == "true" ]] || [[ "$IS_VN_CONTRIBUTE" == "true" ]]); then
            echo "✅ Validation passed: Branch name and PR creator are valid"
          else
            echo "❌ Validation failed"
            echo "Details:"
            echo "- Is VN Developer: ${IS_VN_DEV}"
            echo "- Has Valid Format: ${IS_VALID_FORMAT}"
            echo "- Is VN Contribution: ${IS_VN_CONTRIBUTE}"
            exit 1
          fi
